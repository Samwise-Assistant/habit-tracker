{% extends "base.html" %}

{% block title %}Dashboard - Habit Tracker{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Add Habit Form -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Add New Habit</h2>
        <form action="{{ url_for('add_habit') }}" method="POST" class="flex flex-wrap gap-4 items-end">
            <div class="flex-1 min-w-[150px]">
                <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Icon</label>
                <select name="icon" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                    <option value="âœ…">âœ…</option>
                    <option value="ğŸ’ª">ğŸ’ª</option>
                    <option value="ğŸ“š">ğŸ“š</option>
                    <option value="ğŸƒ">ğŸƒ</option>
                    <option value="ğŸ§˜">ğŸ§˜</option>
                    <option value="ğŸ’§">ğŸ’§</option>
                    <option value="ğŸ¥—">ğŸ¥—</option>
                    <option value="ğŸ’¤">ğŸ’¤</option>
                    <option value="ğŸ¯">ğŸ¯</option>
                    <option value="âœï¸">âœï¸</option>
                </select>
            </div>
            <div class="flex-[2] min-w-[200px]">
                <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Habit Name</label>
                <input type="text" name="name" placeholder="e.g., Read for 30 minutes" required
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
            </div>
            <div class="w-32">
                <label class="block text-sm text-gray-600 dark:text-gray-400 mb-1">Color</label>
                <input type="color" name="color" value="#3B82F6" 
                       class="w-full h-10 px-1 py-1 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer">
            </div>
            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                Add Habit
            </button>
        </form>
    </div>

    <!-- Habits Grid -->
    <div class="grid gap-4">
        {% for item in habits %}
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
            <div class="flex items-start justify-between">
                <div class="flex items-start gap-4">
                    <button onclick="toggleHabit({{ item.habit.id }})" 
                            class="w-12 h-12 rounded-xl flex items-center justify-center text-2xl transition-all transform hover:scale-105
                                   {{ 'bg-green-100 dark:bg-green-900/30' if item.completed_today else 'bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600' }}">
                        {% if item.completed_today %}
                        âœ“
                        {% else %}
                        {{ item.habit.icon }}
                        {% endif %}
                    </button>
                    
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">{{ item.habit.name }}</h3>
                        <div class="flex items-center gap-4 mt-1">
                            <span class="text-sm text-gray-500 flex items-center gap-1">
                                ğŸ”¥ {{ item.streak }} day streak
                            </span>
                            <span class="text-sm text-gray-500">
                                ğŸ“… {{ item.habit.frequency }}
                            </span>
                        </div>
                    </div>
                </div>
                
                <form action="{{ url_for('delete_habit', habit_id=item.habit.id) }}" method="POST" onsubmit="return confirm('Delete this habit?')">
                    <button type="submit" class="text-gray-400 hover:text-red-500 p-2">ğŸ—‘ï¸</button>
                </form>
            </div>
            
            <!-- Heatmap -->
            <div class="mt-4">
                <div class="flex gap-1 justify-end">
                    {% for day in item.heatmap %}
                    <div class="heatmap-cell {{ 'bg-green-500' if day.done else 'bg-gray-200 dark:bg-gray-700' }}" 
                         title="{{ day.date }}"></div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% else %}
        <div class="text-center py-12">
            <div class="text-6xl mb-4">ğŸ¯</div>
            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No habits yet</h3>
            <p class="text-gray-500">Add your first habit above to get started!</p>
        </div>
        {% endfor %}
    </div>
</div>

<form id="toggleForm" method="POST" style="display:none">
    <input type="hidden" name="habit_id" id="toggleHabitId">
</form>

{% endblock %}

{% block scripts %}
<script>
function toggleHabit(habitId) {
    const form = document.getElementById('toggleForm');
    form.action = `/habit/${habitId}/toggle`;
    form.method = 'POST';
    form.submit();
}
</script>
{% endblock %}
